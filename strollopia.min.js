/*! strollopia.js 2014-05-02 */
(function(){angular.module("StrollopiaJS.Config",[]),angular.module("StrollopiaJS.Utils.API",["StrollopiaJS.Config"]),angular.module("StrollopiaJS.Utils.AccessToken",["StrollopiaJS.Utils.API"]),angular.module("StrollopiaJS.Utils.Indicators",[]),angular.module("StrollopiaJS.Utils.Map",["ngStorage"]),angular.module("StrollopiaJS.Utils.i18n",["StrollopiaJS.Config"]),angular.module("StrollopiaJS.Utils.Routes",["ngRoute"]),angular.module("StrollopiaJS.Utils.Templates",[]),angular.module("StrollopiaJS.Utils.Form",[]),angular.module("StrollopiaJS.Utils.Interceptors",[]),angular.module("StrollopiaJS.Utils.MethodCallbacks",[]),angular.module("StrollopiaJS.Utils",["StrollopiaJS.Utils.API","StrollopiaJS.Utils.AccessToken","StrollopiaJS.Utils.Map","StrollopiaJS.Utils.i18n","StrollopiaJS.Utils.Routes","StrollopiaJS.Utils.Indicators","StrollopiaJS.Utils.Form","StrollopiaJS.Utils.Templates","StrollopiaJS.Utils.Interceptors","StrollopiaJS.Utils.MethodCallbacks"]),angular.module("StrollopiaJS.Models",["ngCachedResource","StrollopiaJS.Utils.API","StrollopiaJS.Utils.Indicators","StrollopiaJS.Utils.Interceptors","StrollopiaJS.Utils.MethodCallbacks"]),angular.module("StrollopiaJS.Filters",[]),angular.module("StrollopiaJS.Directives",["StrollopiaJS.Utils.Templates","StrollopiaJS.Utils.Indicators","StrollopiaJS.Utils.i18n"]),angular.module("StrollopiaJS",["StrollopiaJS.Utils","StrollopiaJS.Models","StrollopiaJS.Directives","StrollopiaJS.Filters"])}).call(this),function(){angular.module("StrollopiaJS.Config").provider("StrollopiaConfig",function(){var a;return a={},{configure:function(b){return b(a)},$get:function(){return{get:function(b){return a[b]}}}}})}.call(this),function(){angular.module("StrollopiaJS.Directives").directive("sjsBase64FileModel",["$parse",function(a){return{link:function(b,c,d){var e,f;return e=a(d.sjsBase64FileModel),f=e.assign,c.bind("change",function(a){var c,d;return c=a.target.files.item(0),c?(d=new FileReader,d.onload=function(a){return b.$apply(function(){var d;return d=e(b),null==d&&(d={},f(b,d)),d.name=c.name,d.content=btoa(a.target.result)})},d.readAsBinaryString(c)):void 0})}}}])}.call(this),function(){angular.module("StrollopiaJS.Directives").directive("sjsLoader",["TemplateLoader","Loader",function(a,b){var c;return c={restrict:"E",scope:!0,link:function(c,d,e){var f,g,h,i,j;f=function(a,b,d,f){var g;if(null==b&&(b=null),null==d&&(d=!1),null==f&&(f=!0),null==b&&(b=a),d&&!e[a])throw"Attribute "+attrname+" is required, but not found";return e[a]?(g=e[a],f&&(g=c.$eval(e[a])),c[b]=g):void 0},f("noneTemplate","statusNoneBind"),f("loadingTemplate","loadingBind"),f("failedTemplate","failedBind"),g={statusNoneBind:"sjs-loader/noneTemplate.tpl.html",loadingBind:"sjs-loader/loadingTemplate.tpl.html",failedBind:"sjs-loader/failedTemplate.tpl.html"};for(h in g)j=g[h],null==c[h]&&(c[h]=j);return i=function(){return b.isLoading()?a.bindTemplateToElement(d,c.loadingBind,c):b.failed()?a.bindTemplateToElement(d,c.failedBind,c):a.bindTemplateToElement(d,c.statusNoneBind,c)},c.$watch(function(){return b.status()},function(){return i()}),i()}}}])}.call(this),function(){angular.module("StrollopiaJS.Filters").filter("filterMultiple",["$filter",function(a){return function(b,c){var d;return d={data:b,filteredData:[],applyFilter:function(b,c){var d,e,f,g,h;if(d=[],0===this.filteredData.length&&(this.filteredData=this.data),b){if(e={},angular.isArray(b)){if(angular.isArray(b)&&b.length>0)for(f=g=0,h=b.length;h>=0?h>=g:g>=h;f=h>=0?++g:--g)angular.isDefined(b[f])&&(e[c]=b[f],d=d.concat(a("filter")(this.filteredData,e)))}else e[c]=b,d=d.concat(a("filter")(this.filteredData,e));if(d.length>0)return this.filteredData=d}}},c&&angular.forEach(c,function(a,b){return d.applyFilter(a,b)}),d.filteredData}}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("BaseResource",["$cachedResource","API","LoaderInterceptor","$q","InterceptorChain","MethodCallbacks","$resource",function(a,b,c,d,e,f,g){var h;return h=function(b,i,j,k,l,m){var n,o,p,q,r,s,t,u,v,w,x,y,z,A;null==j&&(j={}),null==k&&(k={}),null==l&&(l=[]),null==m&&(m=!0),z=h.url(i),o=h.addRoot(b),s={id:"@id"},t={responseError:function(a){var b;return null!=(null!=a&&null!=(b=a.data)?b.errors:void 0)&&(a.config.data.$errors=a.data.errors.validations),d.reject(a)}},l.push(t),r={save:{method:"POST",transformRequest:o},update:{method:"PUT",transformRequest:o},query:{method:"GET",isArray:!0},get:{method:"GET"}};for(w in r)r[w].interceptor=new e(l);v=function(a,b){var c,d,e;d={};for(c in b)e=b[c],d[c]=e;for(c in a)e=a[c],d[c]=e;return d},p=v(k,r),this.loaderInterceptor=new c,p=e.modifyMethodByType(p,["GET"],this.loaderInterceptor,function(a){return this.loaderInterceptor.request(!1),a}),q=v(j,s),y=m?a(b,z,q,p):g(z,q,p);for(x in p)n=p[x],("POST"===(A=n.method)||"PUT"===A||"PATCH"===A)&&(u=function(){var a=this;return this.$promise["catch"](function(b){return a.$errors=b.data.errors.validations})},f.after(y,x,u),f.after(y.prototype,"$"+x,u));return y.loaderInterceptor=this.loaderInterceptor,y.prototype.isNew=function(){return null==this.id},y.ignoreLoader=function(a){return null==a&&(a=!0),this.loaderInterceptor.setIgnore(a)},y.isIgnoringLoader=function(){return this.loaderInterceptor.ignore},y.root=b,y},h.addRoot=function(a){return function(b){var c;return c={},c[a]=b,JSON.stringify(c)}},h.url=function(a){var c;return c=a.match(/^https?:\/\//)?a:b.url(a)},h}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Checkpoint",["BaseResource",function(a){return a("checkpoint","/maps/:map_id/checkpoints/:id",{map_id:"@map_id"})}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Map",["BaseResource",function(a){return a("map","/maps/:id",{},{mine:{method:"GET",url:a.url("/maps/mine"),isArray:!0},"public":{method:"GET",url:a.url("/maps/public"),isArray:!0},accessible:{method:"GET",url:a.url("/maps/accessible"),isArray:!0}})}])}.call(this),function(){}.call(this),function(){angular.module("StrollopiaJS.Models").factory("SharedUser",["BaseResource",function(a){return function(b){var c;if(null==b&&(b=null),c=null,angular.isString(b)?c=b:angular.isObject(b)&&null!=b.root&&angular.isString(b.root)?c=b.root:angular.isFunction(b)&&null!=b.root&&angular.isString(b.root)&&(c=b.root),null==c)throw"Unable to decipher parent element of SharedUser. Usage: SharedUser('map').query(parent_id: id)";return a("shared_user","/"+c+"s/:parent_id/shared_users/:id",{parent_id:"@parent_id"},{},[],!1)}}])}.call(this),function(){}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Template",["BaseResource",function(a){return a("template","/templates/:id",{},{mine:{method:"GET",url:a.url("/templates/mine"),isArray:!0},accessible:{method:"GET",url:a.url("/templates/accessible"),isArray:!0}})}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("User",["BaseResource",function(a){return a("user","/users/:id",{},{me:{method:"GET",url:a.url("/users/me")}})}])}.call(this),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/failedTemplate.tpl.html",'<span class="loader-failed">Loading failed</span>')}]),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/loadingTemplate.tpl.html",'<span class="loader-loading"><i class="fa fa-spinner fa-spin"></i>Loading...</span>')}]),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/noneTemplate.tpl.html","")}]),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("AccessToken",["TokenStorage",function(a){var b;return b={set:function(b,c){return null==c&&(c=""),this.email=c,this.token=b,a.accessToken=this.token,a.emailAddress=this.email},clear:function(){return a.accessToken="",a.emailAddress="",b.token=a.accessToken,b.email=a.emailAddress}},b.token=a.accessToken,b.email=a.emailAddress,b}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").provider("AccessTokenRequestIntercepter",["$httpProvider",function(a){var b;return b=void 0,{activate:function(c){return b=c,a.interceptors.push("AccessTokenRequestIntercepter")},$get:["AccessToken","API","$q","$injector",function(a,c,d,e){var f;return f={},f.request=function(f){var g;return!f.url.match("^"+c.rootUrl())||f.url.match("^"+c.url("/(access_token|users)"))&&f.method.match(/post/i)?f:(g=a.token,null!=g&&""!==g?(f.params||(f.params={}),f.params.access_token=g,f):(null!=b&&e.invoke(b),d.reject("No access token")))},f}]}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("fetchAccessToken",["$http","AccessToken","API",function(a,b,c){return function(d,e){return a.post(c.url("/access_token"),{credentials:{email:d,password:e}}).then(function(a){var c;return c=a.data.access_token,b.set(c,d),c})}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("TokenStorage",function(){return localStorage})}.call(this),function(){angular.module("StrollopiaJS.Utils.API").factory("API",["StrollopiaConfig",function(a){return{rootUrl:function(){return a.get("apiRootUrl")||"https://api.strollopia.com"},url:function(a){return""+this.rootUrl()+"/"+a}}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsError",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsError",function(a,b,c){return c.$set("sjsErrorShow",""),c.$set("sjsErrorText","")})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsErrorShow",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsErrorShow",function(a,b,c,d,e){return c.$set("ngShow",""+d+".$errors."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsErrorText",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsErrorText",function(a,b,c,d,e){return c.$set("ngBind",""+d+".$errors."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsField",[function(){return{controller:["$attrs",function(a){return this.field=a.sjsField,null}]}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").service("sjsFormHelpers",["$compile",function(a){return{modelFieldDirective:function(b,c){var d;return d="sjsNoRelink",{require:["^sjsModel","^sjsField"],link:function(e,f,g,h){var i,j;if(g[b]!==d)return j=h[0].model,i=h[1].field,c(e,f,g,j,i),g.$set(b,d),a(f)(e)}}}}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsInput",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsInput",function(a,b,c,d,e){return c.$set("ngModel",""+d+"."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsModel",[function(){return{controller:["$attrs",function(a){return this.model=a.sjsModel,null}]}}])}.call(this),function(){var a;a=window.i18n,window.i18n=void 0,angular.module("StrollopiaJS.Utils.i18n").factory("i18n",["StrollopiaConfig","$rootScope","$q",function(b,c,d){var e,f;return c.t=function(a){return a},e=d.defer(),a.init(b.get("i18n"),function(a){return c.$apply(function(){return c.t=a,e.resolve(a)})}),f=e.promise,function(b){return function(c){return b.then(function(b){return c(b,a)})}}(f)}])}.call(this),function(){var a;a={none:0,loading:1,failed:2},angular.module("StrollopiaJS.Utils.Indicators").factory("Loader",["$rootScope",function(b){var c;return c={loadingState:0,loadFailed:!1,reset:function(){return this.loadingState=0,this.loadFailed=!1},startLoad:function(){return null==this.loadingState&&(this.loadingState=0),this.loadingState++},endLoad:function(){return null==this.loadingState&&(this.loadingState=0),this.loadingState--},fail:function(a){return null==a&&(a=function(){}),this.loadFailed=!0,a()},failed:function(){return this.loadFailed},isLoading:function(){return!this.loadFailed&&this.loadingState>0},status:function(){return this.isLoading()||this.failed()?this.isLoading()&&!this.failed()?a.loading:a.failed:a.none}},null==b.Loader&&(b.Loader=c),b.Loader}])}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("StrollopiaJS.Utils.Indicators").factory("LoaderInterceptor",["Loader","$q",function(b,c){var d;return d=function(){function d(){this.setIgnore=a(this.setIgnore,this),this.responseError=a(this.responseError,this),this.response=a(this.response,this),this.requestError=a(this.requestError,this),this.request=a(this.request,this)}return d.prototype.ignore=!1,d.prototype.request=function(a){return this.ignore||b.startLoad(),a||c.when(a)},d.prototype.requestError=function(a){return this.ignore||b.fail(),c.reject(a)},d.prototype.response=function(a){return this.ignore||b.endLoad(),a||c.when(a)},d.prototype.responseError=function(a){return this.ignore||b.fail(),c.reject(a)},d.prototype.setIgnore=function(a){return null==a&&(a=!0),this.ignore=a},d}(),b.reset(),d}])}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("StrollopiaJS.Utils.Interceptors").factory("InterceptorChain",["$q",function(c){var d;return d=function(){function d(b){null==b&&(b=[]),this.runChain=a(this.runChain,this),this.responseError=a(this.responseError,this),this.response=a(this.response,this),this.requestError=a(this.requestError,this),this.request=a(this.request,this),this.addInterceptor=a(this.addInterceptor,this),this.addInterceptors=a(this.addInterceptors,this),this.requestInterceptors=[],this.responseInterceptors=[],this.addInterceptors(b)}return d.prototype.addInterceptors=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addInterceptor(b));return e},d.prototype.addInterceptor=function(a){return(a.request||a.requestError)&&this.requestInterceptors.push({success:a.request,error:a.requestError}),a.response||a.responseError?this.responseInterceptors.push({success:a.response,error:a.responseError}):void 0},d.prototype.request=function(a){return this.runChain(this.requestInterceptors,c.when(a))},d.prototype.requestError=function(a){return this.runChain(this.requestInterceptors,c.reject(a))},d.prototype.response=function(a){return this.runChain(this.responseInterceptors,c.when(a)).then(this.getResponseData,this.rejectResponse)},d.prototype.responseError=function(a){return this.runChain(this.responseInterceptors,c.reject(a)).then(this.getResponseData,this.rejectResponse)},d.prototype.runChain=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=b.then(c.success,c.error);return b},d.prototype.getResponseData=function(a){return a.resource},d.prototype.rejectResponse=function(a){return c.reject(a)},d.modifyMethodByType=function(a,c,e,f){var g,h,i,j;null==c&&(c=["GET"]),null==e&&(e=null),null==f&&(f=null);for(h in a)g=a[h],null!=g.method&&(j=g.method,b.call(c,j)>=0)&&(null!=f&&(null!=g.transformRequest?angular.isArray(g.transformRequest)?g.transformRequest.push(f):g.transformRequest=[g.transformRequest,f]:g.transformRequest=f),null!=e&&(i=new d,null==g.interceptor&&(g.interceptor=i),g.interceptor instanceof d||(i.addInterceptor(g.interceptor),g.interceptor=i),g.interceptor.addInterceptor(e)));return a},d}()}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Map").factory("CustomMarkerPin",function(){var a;return a={defaultPinSettings:function(){return{color:"#E83A3A",fillOpacity:.9,strokeColor:"#222222",textColor:"#222222",doGradient:!0,scale:1,lineWidth:2,invert:!1,iconKey:"circle",brightnessThreshold:80}},componentToHex:function(a){var b,c;return b=a.toString(16),c=1===b.length?"0"+b:b,c.toUpperCase()},rgbToHex:function(b,c,d){return"#"+a.componentToHex(b)+a.componentToHex(c)+a.componentToHex(d)},hexToRgb:function(a){var b,c;return c=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,a=a.replace(c,function(a,b,c,d){return b+b+c+c+d+d}),b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),null!=b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},colorToRgb:function(b){var c,d,e,f,g,h;return e=a.hexToRgb(b),null!=e?e:(d=document.createElement("div"),d.style.color=b,f=document.body.appendChild(d),c=window.getComputedStyle(d).color,document.body.removeChild(f),h=/(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/,g=h.exec(c),null!=g?{r:parseInt(g[1]),g:parseInt(g[2]),b:parseInt(g[3])}:null)},invertRgb:function(a){var b;return b={},b.r=255-a.r,b.g=255-a.g,b.b=255-a.b,b},rgbString:function(b){return a.rgbaString(b)},rgbaString:function(a,b){return null==b&&(b=1),"rgba("+a.r+","+a.g+","+a.b+","+b+")"},brightnessOfRgb:function(a){return.2126*a.r+.7152*a.g+.0722*a.b},getDimensions:function(b,c){var d,e,f;return null==b&&(b=1),null==c&&(c=2),d=a.getContextSetup(),b/=d.scaleModifier,f=2*d.translateX*b+c,e=2*d.translateY*b+1.4*c,f=Math.round(f),e=Math.round(e),{size:{width:f,height:e},anchor:{x:f/2,y:e}}},getCustomPinURL:function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null==b&&(b={}),b=angular.extend(a.defaultPinSettings(),b),h=a.getContextSetup(),A=h.translateX,B=h.translateY,v=h.scaleModifier,m=h.fontSize,l=h.fontNudge,F=h.workCanvasWidth,E=h.workCanvasWidth,D=document.createElement("canvas"),D.width=F,D.height=E,D.style.display="none",g=D.getContext("2d"),u=b.scale/v,s=b.lineWidth,f=a.colorToRgb(b.color),t=a.colorToRgb(b.strokeColor),x=a.colorToRgb(b.textColor),r=a.invertRgb(x),null==f||null==t||null==x)throw"Invalid color for Custom Marker Pin";return b.invert&&(f=a.invertRgb(f)),k=this.rgbaString(f,b.fillOpacity),w=this.rgbString(t),y=this.rgbString(x),this.brightnessOfRgb(f)<b.brightnessThreshold&&(y=this.rgbString(r)),j=.5,g.save(),g.translate(s/2,B*u+s/2),g.scale(u,u),g.translate(A,B),g.lineCap="butt",g.lineJoin="miter",g.miterLimit=4,g.save(),b.doGradient?(n=g.createLinearGradient(0,-B,0,0),n.addColorStop(.2,k),i={r:Math.round(f.r*j),g:Math.round(f.g*j),b:Math.round(f.b*j)},n.addColorStop(1,this.rgbaString(i,b.fillOpacity)),g.fillStyle=n):g.fillStyle=k,g.strokeStyle=w,g.lineWidth=s/u,h.drawPin(g),g.restore(),g.restore(),g.save(),g.translate(s/2,B*u+s/2),g.scale(u,u),g.translate(A,B),g.font=m+"px FontAwesome",g.fillStyle=y,p=$("<i id='iconCreationElement' class='fa fa-"+b.iconKey+"'></i>"),$("body").append(p),o=document.getElementById("iconCreationElement"),C=window.getComputedStyle(o,":before").content,$("#iconCreationElement").remove(),z=g.measureText(C),g.fillText(C,-(z.width/2),-B-l),g.restore(),c=document.createElement("canvas"),e=2*A*u+s,d=2*B*u+1.4*s,c.width=e,c.height=d,q=g.getImageData(0,0,e,d),c.getContext("2d").putImageData(q,0,0),c.toDataURL("image/png")},getContextSetup:function(a){return null==a&&(a="MAP_PIN"),{translateX:51,translateY:83,scaleModifier:6,fontSize:64,fontNudge:8,workCanvasWidth:220,workCanvasHeight:350,drawPin:function(a){return a.beginPath(),a.moveTo(0,-165),a.bezierCurveTo(-27.618,-165,-50,-143.034,-50,-115.946),a.bezierCurveTo(-50,-88.849,0,0,0,0),a.bezierCurveTo(0,0,50,-88.849,50,-115.946),a.bezierCurveTo(50,-143.034,27.605,-165,0,-165),a.closePath(),a.fill(),a.stroke()}}}}})}.call(this),function(){angular.module("StrollopiaJS.Utils.Map").factory("Geocoder",["$localStorage","$q","$timeout","$rootScope","$http",function(a,b,c,d,e){var f,g,h,i,j,k,l;return k=a.geocodedLocations?JSON.parse(a.geocodedLocations):{},l=[],i=250,f="https://maps.googleapis.com/maps/api/geocode/json",h={OK:"OK",ZERO_RESULTS:"ZERO_RESULTS",REQUEST_DENIED:"REQUEST_DENIED",OVER_QUERY_LIMIT:"OVER_QUERY_LIMIT"},j=function(){var b;return b=l[0],e.get(f,b.config).then(function(e){var f,g,m,n,o,p;switch(f=e.data,o=f.results,p=f.status,n=b.config.address,p){case h.OK:m={lat:o[0].geometry.location.lat,lng:o[0].geometry.location.lng,formattedAddress:o[0].formatted_address},k[n]=m,a.geocodedLocations=JSON.stringify(k),l.shift(),b.d.resolve(m);break;case h.ZERO_RESULTS:l.shift(),b.d.reject({type:"zero",message:"Zero results for geocoding address "+n});break;case h.OVER_QUERY_LIMIT:b.executedAfterPause&&(l.shift(),b.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+n}));break;case h.REQUEST_DENIED:l.shift(),b.d.reject({type:"denied",message:"Request denied for geocoding address "+n});break;default:l.shift(),b.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+p+", address="+n})}return l.length&&(p===h.OVER_QUERY_LIMIT?(g=l[0],g.executedAfterPause=!0,c(j,i)):c(j,0)),d.$$phase?void 0:d.$apply()})},g={googleGeocodeAPIUrl:f,geocode:function(a,c,d){var e,f;return null==c&&(c=!1),null==d&&(d=""),e={address:a,key:d,sensor:c},f=b.defer(),null!=k[a]?f.resolve(k[a]):(l.push({config:e,d:f}),1===l.length&&j()),f.promise}}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Map").factory("MapImage",function(){var a;return a={colorList:["red","green","blue","orange","purple","yellow"],colorIndex:0,maxMarkers:20,getNextColor:function(){return this.colorList[this.colorIndex++%this.colorList.length]},getImageUrl:function(a,b,c,d,e,f){var g,h,i,j,k,l,m;for(null==b&&(b=256),null==c&&(c=256),null==d&&(d=null),null==e&&(e=null),null==f&&(f="roadmap"),k=null!=d?"&zoom="+d:"",g="",null!=e&&(g=null!=e.latitude&&null!=e.longitude?"&center="+e.latitude+","+e.longitude:"&center="+encodeURIComponent(e)),j="",i=0,l=0,m=a.length;m>l&&(h=a[l],null!=h.latitude&&null!=h.longitude&&(j+="&markers=color:"+this.getNextColor()+"|"+h.latitude+","+h.longitude),!(++i>=this.maxMarkers));l++);return"http://maps.googleapis.com/maps/api/staticmap?size="+b+"x"+c+"&sensor=false"+k+g+j},resetColor:function(){var a;return a=0},getMarkerIconUrl:function(a){var b;return null==a&&(a=null),null==a&&(a=this.getNextColor()),b={},"#"===a[0]?(a=a.slice(1,+a.length+1||9e9),"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|"+a):"http://maps.google.com/intl/en_us/mapfiles/ms/micons/"+a+"-dot.png"},getMarkerShadowUrl:function(){return"http://chart.apis.google.com/chart?chst=d_map_pin_shadow"}}})}.call(this),function(){angular.module("StrollopiaJS.Utils.MethodCallbacks").factory("MethodCallbacks",function(){var a;return a=function(a,b,c){var d;if(d=a[b],null==d)throw new Error('No such method: "'+b+'"');if(!angular.isFunction(d))throw new Error('Attribute "'+b+'" is not a method');return c(d)},{after:function(b,c,d){return b[c]=a(b,c,function(a){return function(){return a.apply(this,arguments),d.apply(this)}})},before:function(b,c,d,e){return void 0===e&&(e=d,d=!1),b[c]=a(b,c,function(a){return function(){var b,c;return c=e.apply(this,arguments),b=d?c:arguments,a.apply(this,b)}})}}})}.call(this),function(){angular.module("StrollopiaJS.Utils.Routes").factory("escapeRegExp",function(){return function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}})}.call(this),function(){angular.module("StrollopiaJS.Utils.Routes").factory("Routes",["$route","escapeRegExp",function(a,b){var c,d,e,f,g,h,i;c={},d={},e=function(a,c,d){return function(e){var f,g,h,i,j,k,l,m;for(e||(e={}),i=a,m=c.keys,k=0,l=m.length;l>k;k++){if(g=m[k],f=g.name,!e[f]&&!g.optional)throw"Required parameter :"+f+" missing";j=e[f]||"",h=new RegExp(":"+b(f)+"\\??","g"),i=i.replace(h,j)}return d&&(i="/#"+i),i}},i=a.routes;for(g in i)h=i[g],f=h.helperName,f&&(c[""+f+"_path"]=e(g,h,!0),d[""+f+"_path"]=e(g,h,!1));return c.nohash=d,c}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Templates").factory("TemplateLoader",["$http","$templateCache","$q","$compile",function(a,b,c,d){var e;return e={fetchTemplate:function(d){var e;return e=null,""===b.get(d)&&(e=c.when("")),c.when(e||b.get(d)||a.get(d)).then(function(a){var c;return angular.isObject(a)?(c=a.data,b.put(d,c),c):a})},bindTemplateToElement:function(a,b,c){return null==c&&(c=null),this.fetchTemplate(b).then(function(b){return a.html(b),d(a.contents())(c)})}}}])}.call(this);