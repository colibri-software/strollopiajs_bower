/*! strollopia.js.js 2014-04-04 */
(function(){angular.module("StrollopiaJS.Config",[]),angular.module("StrollopiaJS.Utils.API",["StrollopiaJS.Config"]),angular.module("StrollopiaJS.Utils.AccessToken",["StrollopiaJS.Utils.API"]),angular.module("StrollopiaJS.Utils.Indicators",[]),angular.module("StrollopiaJS.Utils.Map",[]),angular.module("StrollopiaJS.Utils.i18n",["StrollopiaJS.Config"]),angular.module("StrollopiaJS.Utils.Routes",[]),angular.module("StrollopiaJS.Utils.Templates",[]),angular.module("StrollopiaJS.Utils.Form",[]),angular.module("StrollopiaJS.Utils.Interceptors",[]),angular.module("StrollopiaJS.Utils",["StrollopiaJS.Utils.API","StrollopiaJS.Utils.AccessToken","StrollopiaJS.Utils.Map","StrollopiaJS.Utils.i18n","StrollopiaJS.Utils.Routes","StrollopiaJS.Utils.Indicators","StrollopiaJS.Utils.Form","StrollopiaJS.Utils.Templates","StrollopiaJS.Utils.Interceptors"]),angular.module("StrollopiaJS.Models",["ngResource","StrollopiaJS.Utils.API","StrollopiaJS.Utils.Indicators","StrollopiaJS.Utils.Interceptors"]),angular.module("StrollopiaJS.Filters",[]),angular.module("StrollopiaJS.Directives",["StrollopiaJS.Utils.Templates"]),angular.module("StrollopiaJS",["StrollopiaJS.Utils","StrollopiaJS.Models","StrollopiaJS.Directives","StrollopiaJS.Filters"])}).call(this),function(){angular.module("StrollopiaJS.Config").provider("StrollopiaConfig",function(){var a;return a={},{configure:function(b){return b(a)},$get:function(){return{get:function(b){return a[b]}}}}})}.call(this),function(){angular.module("StrollopiaJS.Directives").directive("sjsBase64FileModel",["$parse",function(a){return{link:function(b,c,d){var e,f;return e=a(d.sjsBase64FileModel),f=e.assign,c.bind("change",function(a){var c,d;return c=a.target.files.item(0),c?(d=new FileReader,d.onload=function(a){return b.$apply(function(){var d;return d=e(b),null==d&&(d={},f(b,d)),d.name=c.name,d.content=btoa(a.target.result)})},d.readAsBinaryString(c)):void 0})}}}])}.call(this),function(){angular.module("StrollopiaJS.Directives").directive("sjsLoader",["TemplateLoader",function(a){var b;return b={restrict:"E",scope:{statusNoneBind:"=?noneTemplate",loadingBind:"=?loadingTemplate",failedBind:"=?failedTemplate"},link:function(b,c){var d,e,f,g;if(f=b.$root.Loader){d={statusNoneBind:"sjs-loader/noneTemplate.tpl.html",loadingBind:"sjs-loader/loadingTemplate.tpl.html",failedBind:"sjs-loader/failedTemplate.tpl.html"};for(e in d)g=d[e],null==b[e]&&(b[e]=g);return b.$watch(function(){return f.status()},function(){return f.isLoading()?a.bindTemplateToElement(c,b.loadingBind,b):f.failed()?a.bindTemplateToElement(c,b.failedBind,b):a.bindTemplateToElement(c,b.statusNoneBind,b)})}}}}])}.call(this),function(){angular.module("StrollopiaJS.Filters").filter("filterMultiple",["$filter",function(a){return function(b,c){var d;return d={data:b,filteredData:[],applyFilter:function(b,c){var d,e,f,g,h;if(d=[],0===this.filteredData.length&&(this.filteredData=this.data),b){if(e={},angular.isArray(b)){if(angular.isArray(b)&&b.length>0)for(f=g=0,h=b.length;h>=0?h>=g:g>=h;f=h>=0?++g:--g)angular.isDefined(b[f])&&(e[c]=b[f],d=d.concat(a("filter")(this.filteredData,e)))}else e[c]=b,d=d.concat(a("filter")(this.filteredData,e));if(d.length>0)return this.filteredData=d}}},c&&angular.forEach(c,function(a,b){return d.applyFilter(a,b)}),d.filteredData}}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("BaseResource",["$resource","API","LoaderInterceptor","$q","InterceptorChain",function(a,b,c,d,e){var f;return f=function(b,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v;null==h&&(h={}),null==i&&(i={}),null==j&&(j=[]),u=f.url(g),k=f.addRoot(b),n={id:"@id"},o={responseError:function(a){var b;return null!=(null!=a?null!=(b=a.data)?b.errors:void 0:void 0)&&(a.config.data.$errors=a.data.errors.validations),d.reject(a)}},this.loaderInterceptor=new c,j.push(o),m={save:{method:"POST",transformRequest:k},update:{method:"PUT",transformRequest:k},query:{method:"GET",isArray:!0},get:{method:"GET"}};for(r in m)m[r].interceptor=new e(j);q=function(a,b){var c,d,e;d={};for(c in b)e=b[c],d[c]=e;for(c in a)e=a[c],d[c]=e;return d},l=q(i,m),l=e.modifyMethodByType(l,["GET"],this.loaderInterceptor,function(a){return this.loaderInterceptor.request(!1),a}),t=a(u,q(h,n),l),t.loaderInterceptor=this.loaderInterceptor,t.prototype.isNew=function(){return null==this.id},t.ignoreLoader=function(a){return null==a&&(a=!0),this.loaderInterceptor.setIgnore(a)},t.isIgnoringLoader=function(){return this.loaderInterceptor.ignore},v=t.prototype;for(s in v)p=v[s],0===s.indexOf("$")&&(s=s.substring(1),function(a,b){return t[a]=function(){var a,c,e,f,g,h,i;for(h=-1,f=i=0;3>=i;f=++i)if(angular.isFunction(arguments[f])){h=f;break}return h>=0&&(g=arguments[h],c=h+1,a=arguments[c],e=angular.isFunction(a),arguments[h]=function(b,c){return d.when(b).then(function(a){return g(a,c)},function(b){return e?a(b):void 0})}),b.apply(this,arguments)}}(s,t[s]));return t},f.addRoot=function(a){return function(b){var c;return c={},c[a]=b,JSON.stringify(c)}},f.url=function(a){var c;return c=a.match(/^https?:\/\//)?a:b.url(a)},f}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Checkpoint",["BaseResource",function(a){return a("checkpoint","/maps/:map_id/checkpoints/:id",{map_id:"@map_id"})}])}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Map",["BaseResource",function(a){return a("map","/maps/:id",{},{mine:{method:"GET",url:a.url("/maps/mine"),isArray:!0}})}])}.call(this),function(){}.call(this),function(){}.call(this),function(){angular.module("StrollopiaJS.Models").factory("Template",["BaseResource",function(a){return a("template","/templates/:id",{},{mine:{method:"GET",url:a.url("/templates/mine"),isArray:!0}})}])}.call(this),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/failedTemplate.tpl.html",'<span class="loader-failed">Loading failed</span>')}]),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/loadingTemplate.tpl.html",'<span class="loader-loading"><i class="fa fa-spinner fa-spin"></i>Loading...</span>')}]),angular.module("StrollopiaJS.Directives").run(["$templateCache",function(a){"use strict";a.put("sjs-loader/noneTemplate.tpl.html","")}]),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("AccessToken",["TokenStorage",function(a){var b;return b={set:function(b,c){return null==c&&(c=""),this.email=c,this.token=b,a.accessToken=this.token,a.emailAddress=this.email},clear:function(){return a.accessToken="",a.emailAddress="",b.token=a.accessToken,b.email=a.emailAddress}},b.token=a.accessToken,b.email=a.emailAddress,b}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").provider("AccessTokenRequestIntercepter",["$httpProvider",function(a){var b;return b=void 0,{activate:function(c){return b=c,a.interceptors.push("AccessTokenRequestIntercepter")},$get:["AccessToken","API","$q","$injector",function(a,c,d,e){var f;return f={},f.request=function(f){var g;return!f.url.match("^"+c.rootUrl())||f.url.match("^"+c.url("/access_token"))&&f.method.match(/post/i)?f:(g=a.token,null!=g&&""!==g?(f.params||(f.params={}),f.params.access_token=g,f):(null!=b&&e.invoke(b),d.reject("No access token")))},f}]}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("fetchAccessToken",["$http","AccessToken","API",function(a,b,c){return function(d,e){return a.post(c.url("/access_token"),{credentials:{email:d,password:e}}).then(function(a){var c;return c=a.data.access_token,b.set(c,d),c})}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.AccessToken").factory("TokenStorage",function(){return localStorage})}.call(this),function(){angular.module("StrollopiaJS.Utils.API").factory("API",["StrollopiaConfig",function(a){return{rootUrl:function(){return a.get("apiRootUrl")||"https://api.strollopia.com"},url:function(a){return""+this.rootUrl()+"/"+a}}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.API").value("apiRootUrl","https://api.strollopia.com")}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsError",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsError",function(a,b,c){return c.$set("sjsErrorShow",""),c.$set("sjsErrorText","")})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsErrorShow",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsErrorShow",function(a,b,c,d,e){return c.$set("ngShow",""+d+".$errors."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsErrorText",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsErrorText",function(a,b,c,d,e){return c.$set("ngBind",""+d+".$errors."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsField",[function(){return{controller:["$attrs",function(a){return this.field=a.sjsField,null}]}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").service("sjsFormHelpers",["$compile",function(a){return{modelFieldDirective:function(b,c){var d;return d="sjsNoRelink",{require:["^sjsModel","^sjsField"],link:function(e,f,g,h){var i,j;if(g[b]!==d)return j=h[0].model,i=h[1].field,c(e,f,g,j,i),g.$set(b,d),a(f)(e)}}}}}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsInput",["sjsFormHelpers",function(a){return a.modelFieldDirective("sjsInput",function(a,b,c,d,e){return c.$set("ngModel",""+d+"."+e)})}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Form").directive("sjsModel",[function(){return{controller:["$attrs",function(a){return this.model=a.sjsModel,null}]}}])}.call(this),function(){var a;a=window.i18n,window.i18n=void 0,angular.module("StrollopiaJS.Utils.i18n").factory("i18n",["StrollopiaConfig","$rootScope","$q",function(b,c,d){var e,f;return c.t=function(a){return a},e=d.defer(),a.init(b.get("i18n"),function(a){return c.$apply(function(){return c.t=a,e.resolve(a)})}),f=e.promise,function(b){return function(c){return b.then(function(b){return c(b,a)})}}(f)}])}.call(this),function(){var a;a={none:0,loading:1,failed:2},angular.module("StrollopiaJS.Utils.Indicators").factory("Loader",["$rootScope",function(b){var c;return c={loadingState:0,loadFailed:!1,reset:function(){return this.loadingState=0,this.loadFailed=!1},startLoad:function(){return null==this.loadingState&&(this.loadingState=0),this.loadingState++},endLoad:function(){return null==this.loadingState&&(this.loadingState=0),this.loadingState--},fail:function(a){return null==a&&(a=function(){}),this.loadFailed=!0,a()},failed:function(){return this.loadFailed},isLoading:function(){return!this.loadFailed&&this.loadingState>0},status:function(){return this.isLoading()||this.failed()?this.isLoading()&&!this.failed()?a.loading:a.failed:a.none}},null==b.Loader&&(b.Loader=c),b.Loader}])}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("StrollopiaJS.Utils.Indicators").factory("LoaderInterceptor",["Loader","$q",function(b,c){var d;return d=function(){function d(){this.setIgnore=a(this.setIgnore,this),this.responseError=a(this.responseError,this),this.response=a(this.response,this),this.requestError=a(this.requestError,this),this.request=a(this.request,this)}return d.prototype.ignore=!1,d.prototype.request=function(a){return this.ignore||b.startLoad(),a||c.when(a)},d.prototype.requestError=function(a){return this.ignore||b.fail(),c.reject(a)},d.prototype.response=function(a){return this.ignore||b.endLoad(),a||c.when(a)},d.prototype.responseError=function(a){return this.ignore||b.fail(),c.reject(a)},d.prototype.setIgnore=function(a){return null==a&&(a=!0),this.ignore=a},d}(),b.reset(),d}])}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("StrollopiaJS.Utils.Interceptors").factory("InterceptorChain",["$q",function(c){var d;return d=function(){function d(b){null==b&&(b=[]),this.runChain=a(this.runChain,this),this.responseError=a(this.responseError,this),this.response=a(this.response,this),this.requestError=a(this.requestError,this),this.request=a(this.request,this),this.addInterceptor=a(this.addInterceptor,this),this.addInterceptors=a(this.addInterceptors,this),this.requestInterceptors=[],this.responseInterceptors=[],this.addInterceptors(b)}return d.prototype.addInterceptors=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addInterceptor(b));return e},d.prototype.addInterceptor=function(a){return(a.request||a.requestError)&&this.requestInterceptors.push({success:a.request,error:a.requestError}),a.response||a.responseError?this.responseInterceptors.push({success:a.response,error:a.responseError}):void 0},d.prototype.request=function(a){return this.runChain(this.requestInterceptors,c.when(a))},d.prototype.requestError=function(a){return this.runChain(this.requestInterceptors,c.reject(a))},d.prototype.response=function(a){return this.runChain(this.responseInterceptors,c.when(a)).then(this.getResponseData,this.rejectResponse)},d.prototype.responseError=function(a){return this.runChain(this.responseInterceptors,c.reject(a)).then(this.getResponseData,this.rejectResponse)},d.prototype.runChain=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)c=a[d],b=b.then(c.success,c.error);return b},d.prototype.getResponseData=function(a){return a.resource},d.prototype.rejectResponse=function(a){return c.reject(a)},d.modifyMethodByType=function(a,c,e,f){var g,h,i,j;null==c&&(c=["GET"]),null==e&&(e=null),null==f&&(f=null);for(h in a)g=a[h],null!=g.method&&(j=g.method,b.call(c,j)>=0)&&(null!=f&&(null!=g.transformRequest?angular.isArray(g.transformRequest)?g.transformRequest.push(f):g.transformRequest=[g.transformRequest,f]:g.transformRequest=f),null!=e&&(i=new d,null==g.interceptor&&(g.interceptor=i),g.interceptor instanceof d||(i.addInterceptor(g.interceptor),g.interceptor=i),g.interceptor.addInterceptor(e)));return a},d}()}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Map").factory("MapImage",function(){var a;return a={colorList:["red","green","blue","orange","purple","yellow"],colorIndex:0,maxMarkers:20,getNextColor:function(){return this.colorList[this.colorIndex++%this.colorList.length]},getImageUrl:function(a,b,c,d,e,f){var g,h,i,j,k,l,m;for(null==b&&(b=256),null==c&&(c=256),null==d&&(d=null),null==e&&(e=null),null==f&&(f="roadmap"),k=null!=d?"&zoom="+d:"",g="",null!=e&&(g=null!=e.latitude&&null!=e.longitude?"&center="+e.latitude+","+e.longitude:"&center="+encodeURIComponent(e)),j="",i=0,l=0,m=a.length;m>l&&(h=a[l],null!=h.latitude&&null!=h.longitude&&(j+="&markers=color:"+this.getNextColor()+"|"+h.latitude+","+h.longitude),!(++i>=this.maxMarkers));l++);return"http://maps.googleapis.com/maps/api/staticmap?size="+b+"x"+c+"&sensor=false"+k+g+j},resetColor:function(){var a;return a=0},getMarkerIconUrl:function(a){var b;return null==a&&(a=null),null==a&&(a=this.getNextColor()),b={},"#"===a[0]?(a=a.slice(1,+a.length+1||9e9),"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|"+a):"http://maps.google.com/intl/en_us/mapfiles/ms/micons/"+a+"-dot.png"},getMarkerShadowUrl:function(){return"http://chart.apis.google.com/chart?chst=d_map_pin_shadow"}}})}.call(this),function(){angular.module("StrollopiaJS.Utils.Routes").factory("Routes",["$route","escapeRegExp",function(a,b){var c,d,e,f,g,h,i;c={},d={},e=function(a,c,d){return function(e){var f,g,h,i,j,k,l,m;for(e||(e={}),i=a,m=c.keys,k=0,l=m.length;l>k;k++){if(g=m[k],f=g.name,!e[f]&&!g.optional)throw"Required parameter :"+f+" missing";j=e[f]||"",h=new RegExp(":"+b(f)+"\\??","g"),i=i.replace(h,j)}return d&&(i="/#"+i),i}},i=a.routes;for(g in i)h=i[g],f=h.helperName,f&&(c[""+f+"_path"]=e(g,h,!0),d[""+f+"_path"]=e(g,h,!1));return c.nohash=d,c}])}.call(this),function(){angular.module("StrollopiaJS.Utils.Templates").factory("TemplateLoader",["$http","$templateCache","$q","$compile",function(a,b,c,d){var e;return e={fetchTemplate:function(d){var e;return e=null,""===b.get(d)&&(e=c.when("")),c.when(e||b.get(d)||a.get(d)).then(function(a){var c;return angular.isObject(a)?(c=a.data,b.put(d,c),c):a})},bindTemplateToElement:function(a,b,c){return null==c&&(c=null),this.fetchTemplate(b).then(function(b){return a.html(b),d(a.contents())(c)})}}}])}.call(this);